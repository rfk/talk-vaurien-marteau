<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=1024, user-scalable=no">

  <title>Testing for Graceful Failure with Vaurien and MarteauI</title>

  <link rel="stylesheet" href="./resources/deck-js/core/deck.core.css">
  <link rel="stylesheet" href="./resources/deck-js/extensions/hash/deck.hash.css">
  <link rel="stylesheet" href="./resources/deck-js/themes/style/rfkelly.css">

  <link rel="stylesheet" href="./resources/playitagainsam-js/playitagainsam.css">

  <style type="text/css">
  body .pias-container {
    margin: 1em;
  }
  .deck-container table {
    border-collapse: collapse;
  }
  .deck-container table td {
    padding: 0.5em;
  }
  .deck-container .slide iframe {
    max-width: none;
    margin-bottom: 10px;
  }
  .deck-container div.run-timer {
    position: absolute;
    bottom: 0px;
    left: 0px;
    background: black;
    height: 5px;
    width: 20px;
  }
  .deck-container div.run-timer-toofast {
    background: blue;
  }
  .deck-container div.run-timer-ontrack {
    background: green;
  }
  .deck-container div.run-timer-tooslow {
    background: red;
  }
  .deck-container {
    color: #222222;
  }
  </style>

  <script src="./resources/deck-js/modernizr.custom.js"></script>
  <script src="./resources/deck-js/jquery-1.7.2.min.js"></script>
  <script src="./resources/deck-js/core/deck.core.js"></script>
  <script src="./resources/deck-js/extensions/hash/deck.hash.js"></script>
  <script src="./resources/playitagainsam-js/playitagainsam.js"></script>

  <script type="text/javascript">
  $(function() {
      $.deck('.slide');
  });

  var onEnterSlideCallbacks = {}
  var onEnterSlide = function(selector, cb) {
      var slide_id = $(selector).attr("id");
      if(typeof onEnterSlideCallbacks[slide_id] == "undefined") {
          onEnterSlideCallbacks[slide_id] = [];
      }
      onEnterSlideCallbacks[slide_id].push(cb)
  }
  $(document).bind("deck.change", function(event, from, to) {
      var $slide = $.deck("getSlide", to);
      var slide_id = $slide.attr("id");
      if(showStartTime == null && slide_id != "title") {
          $slide.find(".run-timer").each(function() {
              showStartTime = Math.round((new Date()).getTime() / 1000);
              var times = $(this).attr("id").split("-").slice(1,3);
              showStartTime -= parseInt(times[0], 10);
              updateShowTimers();
          });
      }
      var callbacks = onEnterSlideCallbacks[slide_id];
      if(typeof callbacks != "undefined") {
          for(var i=0; i<callbacks.length; i++) {
              callbacks[i]();
          }
      }
  });

  var showStartTime = null;
  var updateShowTimers = function() {
      if(showStartTime != null) {
          var now = Math.round((new Date()).getTime() / 1000);
          var runtime = now - showStartTime
          $(".run-timer").each(function() {
              var $this = $(this);
              var times = $this.attr("id").split("-").slice(1,3);
              if(runtime < parseInt(times[0], 10)) {
                  $this.removeClass("run-timer-tooslow");
                  $this.removeClass("run-timer-ontrack");
                  $this.addClass("run-timer-toofast");
              } else if(runtime > parseInt(times[1], 10)) {
                  $this.removeClass("run-timer-toofast");
                  $this.removeClass("run-timer-ontrack");
                  $this.addClass("run-timer-tooslow");
              } else {
                  $this.removeClass("run-timer-toofast");
                  $this.removeClass("run-timer-tooslow");
                  $this.addClass("run-timer-ontrack");
              }
          });
      }
      setTimeout(updateShowTimers, 5 * 1000);
  }

  var writePIASSlide = function(id, title, rtStart, rtEnd) {
      document.write('<section class="slide" id="pias-' + id + '-slide">');
      if(title) {
          document.write('<h2>' + title + '</h2>');
      }
      document.write('<div id="pias-' + id + '-player"></div>');
      document.write('<scr' + 'ipt type="text/javascript" src="./resources/pias-' + id + '.js"></scr' + 'ipt>');
      document.write('<scr' + 'ipt type="text/javascript">');
      $(function() {
          onEnterSlide("#pias-" + id + "-slide", function() {
              var player = new PIAS.Player($("#pias-" + id + "-player"))
              var varname = "pias_" + id + "_data";
              while(varname != varname.replace("-", "_")) {
                  varname = varname.replace("-", "_");
              }
              player.play(window[varname], function() {
                  player.destroy();
              });
          });
      });
      document.write('</scr' + 'ipt>');
      if(rtStart && rtEnd) {
          document.write('<div class="run-timer" id="runtime-' + rtStart + '-' + rtEnd + '"> ');
          document.write('</div>');
      }
      document.write('</section>');
  }
  </script>

</head>
<body class="deck-container">

<section class="slide" id="title">
  <h1>Testing for Graceful Failure<br />with Vaurien and Marteau</h1>  
</section>


<section class="slide">
  <h1>Testing!</h1>
</section>


<section class="slide">
  <h2>What do I know anyway?</h2>
 <ul>
   <li>Mozilla Services</li>
   <ul><li>Firefox Sync Server</li></ul>
   <li>Going to show the tools we use:</li>
   <ul><li>Vaurien</li>
       <li>Marteau</li>
   </ul>
   <li>I'm an enthusiast, not an expert</li>
 </ul>
</section>


<section class="slide">
  <h2>Some Real-Life Bugs</h2>
  <p>The out-of-order deletion bug</p>
</section>


<section class="slide">
  <h2>Some Real-Life Bugs</h2>
  <p>The worker-pool-exhaustion bug</p>
</section>


<section class="slide">
  <h1>How do you test for this?</h1>
</section>


<section class="slide">
  <h1>Do it live!</h1>
</section>


<section class="slide">
  <h2>Assumptions</h2>
  <ul>
   <li>Deployment is trivial</li>
   <li>You have functional tests</li>
   <li>Things actually work</li>
  </ul>
</section>


<section class="slide">
  <h1>Vaurien</h1>
</section>


<section class="slide">
  <p>Script Test Run against some service, then show how to throw vaurien into the mix</p>
</section>


<section class="slide">
  <p>Explain the basic paramters, settings, etc</p>
</section>

<section class="slide">
  <p>Script a functional test, using webapi to enable/disable specific behaviours</p>
</section>

<section class="slide">
  <p>Example of using it in a unittest, via in-process control</p>
</section>


<section class="slide">
  <h1>Marteau</h1>
</section>

<section class="slide">
  <p>An easy-to-use frontend for FunkLoad; designed for AWS</p>
</section>

<section class="slide">
  <p>Show how to use it - video?</p>
</section>

<section class="slide">
  <p>Combine the two approaches: give 5% errors on your database, see if only 5% of your requests give an error</p>
</section>

<section class="slide">
  <h1>loads Up</h1>
</section>

<section class="slide">
  <p>we're building a replacement, designed to push more load.  stay tuned</p>
</section>


</section>
<h1>Summing up</h1>
</section>


<section class="slide">
  <h2>Thanks</h2>
  <p>&nbsp;</p>
  <p>Thanks to my colleagues, particularly:</p>
  <ul>
   <li>Tarek Ziade</li>
   <li>Alexis Metaireau</li>
   <li>James Bonacci</li>
  </ul>
</section>


<section class="slide">
  <h2>More Info</h2>
  <div style="text-align: center">
  <p>ryan@rfk.id.au</p>
  <p>@rfkelly</p>
  <br /><br />
  <p>https://github.com/rfk/talk-vaurien-marteau</p>
  <br /><br />
  <p>http://vaurien.readthedocs.org</p>
  <p>http://marteau.readthedocs.org</p>
  </div>
</section>

</body>
</html>
